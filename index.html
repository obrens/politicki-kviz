<!doctype html>
<html lang="sr">
<head>
<meta charset="utf-8" /><meta name="viewport" content="width=device-width,initial-scale=1" /><title>Брзи политички квиз</title>
<style>
body { font-family: system-ui,sans-serif; background: #f0f1f5; margin: 0; }
.wrapper { max-width: 800px; margin: 32px auto; background: #fff; padding: 32px; border-radius: 16px; }
h1 { text-align: center; font-size: 30px; margin:0; font-weight:800; color: #2c3e50;}
p.subtitle { text-align: center; color: #555; margin-top: 4px; font-size: 16px; }
.controls {display:flex;gap:12px;margin:28px 0;flex-wrap:wrap;}
button {padding:12px 18px;border:none;border-radius:10px;background:#4a6ea9;color:#fff;font-weight:600;cursor:pointer;}
button:hover {background:#305890;}
#shareLink { flex-grow:1; padding:12px; border-radius:8px; border:1px solid #ccc; font-size:13px;}
.linkCopied { color:#4a6ea9;font-size:13px;font-weight:600;padding:12px 0;}
footer {margin-top:40px;color:#777;font-size:14px;text-align:center;}
#quiz {display:grid;grid-template-columns:repeat(3,1fr);gap:16px;}
@media (max-width:900px){#quiz{grid-template-columns:1fr;}}
.topic-separator{grid-column:1/-1; height:1px; background:linear-gradient(to right,transparent,#d0d5dd 18%,#d0d5dd 82%,transparent); margin:8px 0; position:relative;}
.topic-separator::before{content:attr(data-topic);position:absolute;left:50%;top:50%;transform:translate(-50%,-50%);background:#f0f1f5;padding:2px 12px;font-size:13px;font-weight:600;color:#4a6ea9;}
.question{background:#fff;border-left:5px solid #6b7280;border-radius:12px;padding:16px;box-shadow:0 2px 8px rgba(0,0,0,.04);}
.question div:first-child{font-size:16px;font-weight:600;color:#2c3e50;}
.yesno{display:flex;justify-content:space-around;margin-top:8px;gap:8px;}
.yesno label{flex:1;cursor:pointer;font-size:14px;text-align:center;}
.yesno input{display:none;}
.yesno span{display:block;padding:8px 0;border-radius:8px;border:2px solid #ccc;font-weight:600;background:#fff;}
.yesno input:checked + span{background:#4a6ea9;color:#fff;border-color:#4a6ea9;}
.wordCardBox{background:#f7f9fc;border-radius:12px;border:1.5px solid #d8dbed;max-width:410px;margin:0 auto 16px auto;padding:12px;}
.wordCardBox h3{margin-top:0;margin-bottom:8px;color:#2c3e50;font-size:15px;font-weight:700;text-align:center;}
.wordCards{display:flex;flex-direction:column;gap:9px;}
.wordCard{display:flex;justify-content:space-between;align-items:center;background:#fff;border-radius:9px;box-shadow:0 1px 6px rgba(60,90,160,.06);padding:6px 12px;}
.wordCard .axis{color:#3157a8;font-weight:700;font-size:14px;}
.wordCard .label{color:#3157a8;background:#eef1fc;font-weight:700;padding:2px 10px;border-radius:7px;font-size:14px;}
#shareableBars{margin-top:28px;padding:18px;background:#fff;border-radius:12px;box-shadow:0 2px 8px rgba(0,0,0,.08);display:none;}
#shareableBars h2{text-align:center;color:#2c3e50;font-size:19px;font-weight:700;margin:0 0 16px 0;}
.friend-explanation{text-align:center;color:#777;font-size:12px;font-style:italic;margin-bottom:9px;}
.shareBar{margin:14px 0;}
.shareBar strong{display:block;margin-bottom:2px;color:#2c3e50;font-size:14px;}
.shareBar .spectrum{position:relative;height:7px;background:linear-gradient(to right,#e8edf2 0%,#d4dce5 50%,#e8edf2 100%);border-radius:4px;margin:7px 0;}
.shareBar .marker{position:absolute;top:50%;transform:translate(-50%,-50%);width:15px;height:15px;background:#4a6ea9;border:2px solid #fff;border-radius:50%;box-shadow:0 1px 2px rgba(0,0,0,.06);}
.shareBar .shadowMarker{position:absolute;top:50%;transform:translate(-50%,-50%);width:15px;height:15px;background:#bbb;border:2px solid #fff;border-radius:50%;opacity:0.44;}
.shareBar .labels{display:flex;justify-content:space-between;font-size:11px;margin-top:2px;}
.shareBar .labels span{color:#6b7280;font-weight:500;}
.shareBar .labels span.highlight{font-weight:700;color:#2c3e50;}
#compactShare{margin-top:2em;display:none;}
#compactShareGraphic{background:#f7f9fc;border-radius:12px;border:1.5px solid #d8dbed;max-width:410px;margin:0 auto 12px auto;padding:12px;}
#compactShareGraphic h3{margin-top:0;margin-bottom:8px;color:#2c3e50;font-size:15px;font-weight:700;text-align:center;}
#compactShareActions{display:flex;gap:0.7em;justify-content:center;margin-bottom:1em;}
#copyCompactLink,#downloadCompactImage{padding:7px 14px;border-radius:7px;border:none;font-weight:600;font-size:13px;background:#e8edf2;box-shadow:0 1px 4px rgba(60,90,160,.07);cursor:pointer;}
#copyCompactLink{background:#4a6ea9;color:#fff;}
#copyCompactLink:hover{background:#305890;}
#downloadCompactImage{color:#224082;}
#downloadCompactImage:hover{background:#cadeed;}
#compactLinkField{width:100%;margin-top:7px;padding:7px;border-radius:5px;border:1px solid #ccc;font-size:12px;text-align:center;}
.linkCopiedCompact{color:#4a6ea9;font-size:13px;font-weight:700;padding:0.8em 0;}
</style>
<script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>
</head>
<body>
<div class="wrapper">
<h1>Брзи политички квиз</h1>
<p class="subtitle">Квиз политичке оријентације у српској политици</p>

<div id="friendResults" class="wordCardBox" style="display:none;"></div>
<div id="quiz"></div>
<div class="controls">
  <button id="show">Прикажи резултат</button>
  <button id="reset">Ресетуј</button>
  <button id="copyLink">Копирај линк са потпуним резултатима (све одговоре)</button>
  <input id="shareLink" readonly placeholder="Линк за чување потпуних резултата" />
  <span class="linkCopied" id="copyStatus" style="display:none;">✓ Копирано!</span>
</div>
<div id="shareableBars"></div>
<button id="downloadImage" style="display:none;">Преузми слику резултата</button>
<div id="compactShare"></div>
<footer>
Економија: тржишна — државна · Спољна политика: антизападна — прозападна · Ауторитет: аутократија — револуција · Култура: традиционална — прогресивна
</footer>
</div>
<script>
const axes = [
  { id:0, name:"Економија", left:"тржишна", right:"државна" },
  { id:1, name:"Спољна политика", left:"антизападна", right:"прозападна" },
  { id:2, name:"Ауторитет", left:"аутократија", right:"револуција" },
  { id:3, name:"Култура", left:"традиционална", right:"прогресивна" }
];
const questions = [
  {axis:0, dir:1,  text:"Превише тога смо приватизовали"},
  {axis:0, dir:1,  text:"Капитализам је довео до превелике разлике између богатих и сиромашних"},
  {axis:0, dir:-1, text:"Државни пензиони систем је попут пирамидалне шеме, и мора се хитно реформисати или приватизовати"},
  {axis:1, dir:1, text:"Србија треба да уђе у ЕУ или НАТО"},
  {axis:1, dir:-1, text:"Превише слушамо диктате међународних институција попут Хашког трибунала, ММФ-а, Светске здравствене организације"},
  {axis:1, dir:1, text:"Морамо да прихватимо реалност по питању Косова како бисмо напредовали"},
  {axis:2, dir:-1, text:"Треба да се чувамо да нам се не догоди обојена револуција"},
  {axis:2, dir:1, text:"Србији фали људских права и демократије"},
  {axis:2, dir:-1, text:"Неке странке, медије или политичаре треба забранити"},
  {axis:3, dir:1, text:"Треба укинути школску славу — нисмо сви Православци"},
  {axis:3, dir:-1, text:"ЛГБТ пропаганда је штетна за друштво"},
  {axis:3, dir:-1, text:"По питању имиграције треба више да се угледамо на Мађарску него на Шведску"}
];
let friendScores = null;

function score() {
  const scores = [0,0,0,0], counts = [0,0,0,0];
  questions.forEach((q,i)=>{
    const val = Number(document.querySelector(`input[name=q${i}]:checked`).value);
    scores[q.axis] += val * q.dir;
    counts[q.axis]++;
  });
  return scores.map((s,i) => s / counts[i]);
}
function encode(a){ try { return btoa(a.join(',')); } catch{ return ''; } }
function decode(s){ try { return atob(s).split(',').map(Number); } catch{ return null; } }

// Render word card area (used by friendResults and compactShare)
function renderWordCards(container, results, heading) {
  container.innerHTML = `<h3>${heading}</h3>`;
  const bars = document.createElement('div');
  bars.className = 'wordCards';
  axes.forEach((ax,i) => {
    const val = results[i];
    let label = val < 0 ? ax.left : ax.right;
    const bar = document.createElement('div');
    bar.className = 'wordCard';
    bar.innerHTML = `<span class="axis">${ax.name}:</span> <span class="label">${label}</span>`;
    bars.appendChild(bar);
  });
  container.appendChild(bars);
  container.style.display = 'block';
}

// Results section with bars, optional friend shadows
function renderShareableBars(res){
  const container = document.getElementById('shareableBars');
  let explanation = friendScores ? `<div class="friend-explanation">Сенке представљају резултате вашег пријатеља за поређење.</div>` : '';
  container.innerHTML = `<h2>Ваш политички компас</h2>${explanation}`;
  axes.forEach((ax,i) => {
    const val = res[i], position = 50 + val * 50;
    const bar = document.createElement('div'); bar.className = 'shareBar';
    let shadowHTML = '';
    if(friendScores) {
      const friendPos = 50 + friendScores[i]*50;
      shadowHTML = `<div class="shadowMarker" style="left:${friendPos}%"></div>`;
    }
    bar.innerHTML = `
      <strong>${ax.name}</strong>
      <div class="spectrum">${shadowHTML}<div class="marker" style="left:${position}%"></div></div>
      <div class="labels">
        <span class="${val<0?'highlight':''}">${ax.left}</span>
        <span class="${val>0?'highlight':''}">${ax.right}</span>
      </div>`;
    container.appendChild(bar);
  });
  container.style.display = 'block';
  document.getElementById('downloadImage').style.display = 'block';
  // Compact share
  renderCompactShare(res, generateLink(res));
}

function generateLink(res){
  const answers = questions.map((q,i)=> Number(document.querySelector(`input[name=q${i}]:checked`).value) * q.dir);
  const fullLink = location.origin + location.pathname + '?r=' + encode(answers);
  document.getElementById('shareLink').value = fullLink;
  return fullLink;
}

document.getElementById('show').onclick = () => {
  renderShareableBars(score());
  document.getElementById('compactShare').style.display = 'block';
  document.getElementById('friendResults').style.display = 'none';
};
document.getElementById('reset').onclick = () => location.href = location.pathname;
document.getElementById('copyLink').onclick = () => { 
  const el = document.getElementById('shareLink'); el.select(); document.execCommand('copy');
  const status = document.getElementById('copyStatus');
  status.style.display = 'inline'; setTimeout(() => status.style.display = 'none', 1200);
};
document.getElementById('downloadImage').onclick = function () {
  window.html2canvas(document.getElementById('shareableBars'),{backgroundColor:null,scale:2}).then(function(canvas){
    const link = document.createElement('a');
    link.download = 'politicki-kompas.png'; link.href = canvas.toDataURL(); link.click();
  });
};
// Compact share area w/actions
function renderCompactShare(res, link) {
  const out = document.getElementById('compactShare');
  out.innerHTML = '';
  const graphic = document.createElement('div');
  graphic.id = "compactShareGraphic";
  renderWordCards(graphic, res, "Моја политика");
  out.appendChild(graphic);

  // Actions
  const actions = document.createElement('div');
  actions.id = "compactShareActions";
  // Copy link
  const copyBtn = document.createElement('button');
  copyBtn.id = "copyCompactLink"; copyBtn.textContent = "Копирај линк за поређење"; actions.appendChild(copyBtn);
  // PNG download
  const downloadBtn = document.createElement('button');
  downloadBtn.id = "downloadCompactImage"; downloadBtn.textContent = "Преузми слику за поређење"; actions.appendChild(downloadBtn);
  // Link field
  const linkField = document.createElement('input');
  linkField.id = "compactLinkField"; linkField.readOnly = true; linkField.value = link; actions.appendChild(linkField);
  // Copy status
  const copyStatus = document.createElement('span');
  copyStatus.className = "linkCopiedCompact"; copyStatus.id = "copyStatusCompact";
  copyStatus.style.display = "none"; copyStatus.textContent = "✓ Копирано!"; actions.appendChild(copyStatus);
  out.appendChild(actions);
  // Copy logic
  copyBtn.onclick = () => {
    linkField.select(); document.execCommand('copy');
    copyStatus.style.display = 'inline';
    setTimeout(() => copyStatus.style.display = 'none', 1100);
  };
  downloadBtn.onclick = () => {
    window.html2canvas(graphic,{backgroundColor:null,scale:2}).then(function(canvas){
      const link = document.createElement('a');
      link.download = 'politicki-kompas-compact.png';
      link.href = canvas.toDataURL(); link.click();
    });
  };
  out.style.display = 'block';
}
// Quiz builder
const quizDiv = document.getElementById('quiz');
let lastAxis = -1;
questions.forEach((q,i)=>{
  if(q.axis !== lastAxis){
    const sep = document.createElement('div');
    sep.className = 'topic-separator';
    sep.setAttribute('data-topic', axes[q.axis].name.toUpperCase());
    quizDiv.appendChild(sep); lastAxis = q.axis;
  }
  const d = document.createElement('div'); d.className='question';
  const p = document.createElement('div'); p.textContent = q.text;
  const btnDiv = document.createElement('div'); btnDiv.className='yesno';
  [{label:'Не',value:-1},{label:'Да',value:1}].forEach(opt=>{
    const lab = document.createElement('label');
    lab.innerHTML = `<input type="radio" name="q${i}" value="${opt.value}" ${opt.value===-1?'checked':''}><span>${opt.label}</span>`;
    btnDiv.appendChild(lab);
  });
  d.appendChild(p); d.appendChild(btnDiv); quizDiv.appendChild(d);
});
// Pre-fill from URL for friends
(function(){
  const p = new URLSearchParams(location.search);
  if(p.has('r')){
    const dec = decode(p.get('r'));
    if(dec && dec.length === questions.length){
      // friend's scores
      const scores = [0,0,0,0], counts = [0,0,0,0];
      questions.forEach((q,i)=>{
        scores[q.axis] += dec[i]; counts[q.axis]++;
      });
      friendScores = scores.map((s,i)=>s/counts[i]);
      renderWordCards(document.getElementById('friendResults'), friendScores, "Резултати вашег пријатеља за поређење");
      document.getElementById('friendResults').style.display = 'block';
      // Reset user's answers to neutral
      questions.forEach((q,i)=>{
        document.querySelector(`input[name=q${i}][value='-1']`).checked = true;
      });
    } else {
      document.getElementById('friendResults').style.display = 'none';
    }
  }
})();
</script>
</body>
</html>
