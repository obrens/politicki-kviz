<!doctype html>
<html lang="sr">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Брзи политички квиз</title>
<style>
body { font-family: system-ui, sans-serif; background: #f0f1f5; margin: 0; padding: 0; }
.wrapper { max-width: 1100px; margin: 32px auto; background: #fff; padding: 32px; border-radius: 20px; box-shadow: 0 6px 25px rgba(0,0,0,0.1); }
@media (max-width: 1150px) {
  .wrapper { max-width: 500px; }
}
h1 { text-align: center; font-size: 32px; font-weight: 800; margin-top: 0; color: #2c3e50; }
p.subtitle { text-align: center; color: #555; margin-top: 4px; font-size: 16px; }

#friendResults { background: #f8f9fa; border: 2px solid #d0d5dd; border-radius: 12px; padding: 20px; margin-bottom: 24px; }
#friendResults h3 { margin: 0 0 16px 0; color: #2c3e50; font-size: 18px; text-align: center; }
#friendResults .miniBar { margin: 12px 0; }
#friendResults .miniBar strong { display: block; margin-bottom: 4px; color: #2c3e50; font-size: 14px; }
#friendResults .miniSpectrum { position: relative; height: 6px; background: linear-gradient(to right, #e8edf2 0%, #d4dce5 50%, #e8edf2 100%); border-radius: 3px; }
#friendResults .miniMarker { position: absolute; top: 50%; transform: translate(-50%, -50%); width: 12px; height: 12px; background: #6b7280; border: 2px solid #fff; border-radius: 50%; }

#quiz { display: grid; grid-template-columns: repeat(3, 1fr); gap: 16px; }
@media (max-width: 1150px) {
  #quiz { grid-template-columns: 1fr; }
}
.topic-separator { grid-column: 1 / -1; height: 1px; background: linear-gradient(to right, transparent, #d0d5dd 20%, #d0d5dd 80%, transparent); margin: 8px 0; position: relative; }
.topic-separator::before { content: attr(data-topic); position: absolute; left: 50%; top: 50%; transform: translate(-50%, -50%); background: #f0f1f5; padding: 4px 16px; font-size: 13px; font-weight: 600; color: #6b7280; letter-spacing: 0.5px; }
.question { background: #fff; border-left: 6px solid #7b8a9e; border-radius: 12px; padding: 16px 16px 12px 16px; box-shadow: 0 2px 8px rgba(0,0,0,0.05); display: flex; flex-direction: column; }
.question div:first-child { font-size: 16px; font-weight: 600; color: #2c3e50; line-height: 1.3; }

.yesno { display: flex; justify-content: space-around; margin-top: 8px; gap:8px; }
.yesno label { flex:1; cursor: pointer; font-size: 14px; text-align: center; }
.yesno input { display: none; }
.yesno span { display: block; padding: 8px 0; border-radius: 8px; border: 2px solid #ccc; transition: all 0.2s; font-weight: 600; background: #fff; }
.yesno input:checked + span { background:#4a6ea9; color:#fff; border-color:#4a6ea9; transform: scale(1.05); }

.controls { display: flex; gap: 12px; margin: 24px 0; flex-wrap: wrap; }
button { flex-shrink:0; padding: 12px 20px; border: none; border-radius: 12px; background: #4a6ea9; color: white; font-weight: 600; cursor: pointer; transition: background 0.2s; }
button:hover { background: #3b5780; }
#shareLink { flex-grow: 1; padding: 12px; border-radius: 8px; border: 1px solid #ccc; font-size: 13px; }
.linkCopied { color: #4a6ea9; font-size: 13px; font-weight: 600; padding: 12px 0; }

footer { margin-top: 40px; color: #666; font-size: 14px; text-align: center; }

#shareableBars { margin-top: 32px; padding: 24px; background: #fff; border-radius: 16px; box-shadow: 0 4px 20px rgba(0,0,0,0.08); }
#shareableBars h2 { text-align: center; color: #2c3e50; font-size: 24px; font-weight: 700; margin: 0 0 24px 0; }
.shareBar { margin: 24px 0; }
.shareBar strong { display: block; margin-bottom: 8px; color: #2c3e50; font-size: 16px; font-weight: 600; }
.shareBar .spectrum { position: relative; height: 8px; background: linear-gradient(to right, #e8edf2 0%, #d4dce5 50%, #e8edf2 100%); border-radius: 4px; margin: 12px 0; }
.shareBar .marker { position: absolute; top: 50%; transform: translate(-50%, -50%); width: 20px; height: 20px; background: #4a6ea9; border: 3px solid #fff; border-radius: 50%; box-shadow: 0 2px 8px rgba(74,110,169,0.4); transition: all 0.3s ease; z-index: 2; }
.shareBar .friendMarker { position: absolute; top: 50%; transform: translate(-50%, -50%); width: 20px; height: 20px; background: transparent; border: 3px solid #6b7280; border-radius: 50%; box-shadow: 0 2px 8px rgba(107,114,128,0.3); z-index: 1; }
.shareBar .labels { display: flex; justify-content: space-between; font-size: 14px; margin-top: 8px; }
.shareBar .labels span { color: #6b7280; font-weight: 500; }
.shareBar .labels span.highlight { font-weight: 700; color: #2c3e50; }

#compactShare { margin-top: 20px; padding: 16px; background: #f8f9fa; border-radius: 12px; border: 2px dashed #d0d5dd; }
#compactShare h3 { margin: 0 0 12px 0; color: #2c3e50; font-size: 16px; text-align: center; }
#compactShare .compactBars { display: flex; flex-direction: column; gap: 8px; }
#compactShare .compactBar { display: flex; align-items: center; gap: 8px; }
#compactShare .compactBar span { font-size: 13px; color: #555; min-width: 140px; }
#compactShare .compactSpectrum { position: relative; flex: 1; height: 6px; background: linear-gradient(to right, #e8edf2 0%, #d4dce5 50%, #e8edf2 100%); border-radius: 3px; }
#compactShare .compactMarker { position: absolute; top: 50%; transform: translate(-50%, -50%); width: 12px; height: 12px; background: #4a6ea9; border: 2px solid #fff; border-radius: 50%; }
</style>
</head>
<body>
<div class="wrapper">
<h1>Брзи политички квиз</h1>
<p class="subtitle">Квиз политичке оријентације у српској политици</p>

<div id="friendResults" style="display:none;"></div>

<div id="quiz"></div>

<div class="controls">
  <button id="show">Прикажи резултат</button>
  <button id="reset">Ресетуј</button>
  <button id="copyLink">Копирај линк</button>
  <input id="shareLink" readonly />
  <span class="linkCopied" id="copyStatus" style="display:none;">✓ Копирано!</span>
</div>

<div id="shareableBars"></div>
<div id="compactShare" style="display:none;"></div>

<footer>
Економија: тржишна — државна · Спољна политика: антизападна — прозападна · Ауторитет: аутократија — револуција · Култура: традиционална — прогресивна
</footer>
</div>

<script>
const axes = [
  { id:0, name:"Економија", left:"тржишна", right:"државна" },
  { id:1, name:"Спољна политика", left:"антизападна", right:"прозападна" },
  { id:2, name:"Ауторитет", left:"аутократија", right:"револуција" },
  { id:3, name:"Култура", left:"традиционална", right:"прогресивна" }
];

const questions = [
  {axis:0, dir:1,  text:"Превише тога смо приватизовали"},
  {axis:0, dir:1,  text:"Капитализам је довео до превелике разлике између богатих и сиромашних"},
  {axis:0, dir:-1, text:"Државни пензиони систем је попут пирамидалне шеме, и мора се хитно реформисати или приватизовати"},

  {axis:1, dir:1, text:"Србија треба да уђе у ЕУ или НАТО"},
  {axis:1, dir:-1, text:"Превише слушамо диктате међународних институција попут Хашког трибунала, ММФ-а, Светске здравствене организације"},
  {axis:1, dir:1, text:"Морамо да прихватимо реалност по питању Косова како бисмо напредовали"},

  {axis:2, dir:1, text:"Треба да се чувамо да нам се не догоди обојена револуција"},
  {axis:2, dir:-1, text:"Србији фали људских права и демократије"},
  {axis:2, dir:1, text:"Неке странке, медије или политичаре треба забранити"},

  {axis:3, dir:1, text:"Треба укинути школску славу — нисмо сви Православци"},
  {axis:3, dir:-1, text:"ЛГБТ пропаганда је штетна за друштво"},
  {axis:3, dir:-1, text:"По питању имиграције треба више да се угледамо на Мађарску него на Шведску"}
];

let friendScores = null;

// Generate quiz
const quizDiv = document.getElementById('quiz');
let lastAxis = -1;
questions.forEach((q,i)=>{
  if(q.axis !== lastAxis){
    const sep = document.createElement('div');
    sep.className = 'topic-separator';
    sep.setAttribute('data-topic', axes[q.axis].name.toUpperCase());
    quizDiv.appendChild(sep);
    lastAxis = q.axis;
  }
  
  const d = document.createElement('div'); 
  d.className='question';
  const p = document.createElement('div'); 
  p.textContent = q.text;
  const btnDiv = document.createElement('div'); 
  btnDiv.className='yesno';
  
  [{label:'Не',value:-1},{label:'Да',value:1}].forEach(opt=>{
    const lab = document.createElement('label');
    lab.innerHTML = `<input type="radio" name="q${i}" value="${opt.value}" ${opt.value===-1?'checked':''}><span>${opt.label}</span>`;
    btnDiv.appendChild(lab);
  });
  
  d.appendChild(p); 
  d.appendChild(btnDiv);
  quizDiv.appendChild(d);
});

// Calculate scores
function score() {
  const scores = [0,0,0,0];
  const counts = [0,0,0,0];
  
  questions.forEach((q,i)=>{
    const val = Number(document.querySelector(`input[name=q${i}]:checked`).value);
    scores[q.axis] += val * q.dir;
    counts[q.axis]++;
  });
  
  return scores.map((s,i) => s / counts[i]);
}

// Encode/decode
function encode(a){ try { return btoa(a.join(',')); } catch{ return ''; } }
function decode(s){ try { return atob(s).split(',').map(Number); } catch{ return null; } }

// Show friend results at top
function showFriendResults(scores) {
  const container = document.getElementById('friendResults');
  container.innerHTML = '<h3>Резултати вашег пријатеља</h3>';
  
  axes.forEach((ax,i)=>{
    const val = scores[i];
    const position = 50 + val * 50;
    const bar = document.createElement('div');
    bar.className = 'miniBar';
    bar.innerHTML = `
      <strong>${ax.name}</strong>
      <div class="miniSpectrum">
        <div class="miniMarker" style="left:${position}%"></div>
      </div>`;
    container.appendChild(bar);
  });
  
  container.style.display = 'block';
}

// Render results
function renderShareableBars(res){
  const container = document.getElementById('shareableBars');
  container.innerHTML = '<h2>Ваш политички компас</h2>';
  
  axes.forEach((ax,i)=>{
    const val = res[i];
    const position = 50 + val * 50;
    const bar = document.createElement('div'); 
    bar.className='shareBar';
    
    let friendMarkerHTML = '';
    if(friendScores) {
      const friendPos = 50 + friendScores[i] * 50;
      friendMarkerHTML = `<div class="friendMarker" style="left:${friendPos}%"></div>`;
    }
    
    bar.innerHTML = `
      <strong>${ax.name}</strong>
      <div class="spectrum">
        ${friendMarkerHTML}
        <div class="marker" style="left:${position}%"></div>
      </div>
      <div class="labels">
        <span class="${val<0?'highlight':''}">${ax.left}</span>
        <span class="${val>0?'highlight':''}">${ax.right}</span>
      </div>`;
    container.appendChild(bar);
  });
  
  // Hide friend results box if shown
  document.getElementById('friendResults').style.display = 'none';
  
  // Generate links
  const answers = questions.map((q,i)=> Number(document.querySelector(`input[name=q${i}]:checked`).value) * q.dir);
  const fullLink = location.origin + location.pathname + '?r=' + encode(answers);
  document.getElementById('shareLink').value = fullLink;
  
  // Generate compact share
  renderCompactShare(res, fullLink);
}

// Render compact shareable graphic
function renderCompactShare(res, link) {
  const container = document.getElementById('compactShare');
  container.innerHTML = '<h3>Компактан приказ за дељење</h3><div class="compactBars"></div>';
  
  const barsContainer = container.querySelector('.compactBars');
  axes.forEach((ax,i)=>{
    const val = res[i];
    const position = 50 + val * 50;
    const bar = document.createElement('div');
    bar.className = 'compactBar';
    bar.innerHTML = `
      <span>${ax.name}</span>
      <div class="compactSpectrum">
        <div class="compactMarker" style="left:${position}%"></div>
      </div>`;
    barsContainer.appendChild(bar);
  });
  
  const linkDiv = document.createElement('div');
  linkDiv.style.marginTop = '12px';
  linkDiv.innerHTML = `
    <button id="copyCompactLink" style="width:100%; padding:10px;">Копирај компактан линк</button>
    <input id="compactLinkField" readonly value="${link}" style="width:100%; margin-top:8px; padding:8px; border-radius:6px; border:1px solid #ccc; font-size:12px;">
  `;
  container.appendChild(linkDiv);
  
  container.style.display = 'block';
  
  document.getElementById('copyCompactLink').onclick = () => {
    const el = document.getElementById('compactLinkField');
    el.select();
    document.execCommand('copy');
    document.getElementById('copyCompactLink').textContent = '✓ Копирано!';
    setTimeout(() => {
      document.getElementById('copyCompactLink').textContent = 'Копирај компактан линк';
    }, 2000);
  };
}

// Buttons
document.getElementById('show').onclick = () => {
  renderShareableBars(score());
  document.getElementById('shareableBars').style.display = 'block';
};

document.getElementById('reset').onclick = () => location.href = location.pathname;

document.getElementById('copyLink').onclick = () => { 
  const el = document.getElementById('shareLink'); 
  el.select(); 
  document.execCommand('copy');
  const status = document.getElementById('copyStatus');
  status.style.display = 'inline';
  setTimeout(() => status.style.display = 'none', 2000);
};

// Pre-fill from URL
(function(){
  const p = new URLSearchParams(location.search);
  if(p.has('r')){
    const dec = decode(p.get('r'));
    if(dec && dec.length === questions.length){
      // Calculate friend's scores
      const scores = [0,0,0,0];
      const counts = [0,0,0,0];
      questions.forEach((q,i)=>{
        scores[q.axis] += dec[i];
        counts[q.axis]++;
      });
      friendScores = scores.map((s,i) => s / counts[i]);
      
      // Show friend results at top
      showFriendResults(friendScores);
      
      // Reset all questions to neutral (Не)
      questions.forEach((q,i)=>{
        document.querySelector(`input[name=q${i}][value='-1']`).checked = true;
      });
    }
  }
})();
</script>
</body>
</html>
